<div class="space-y-6">
  <%= render PageHeaderComponent.new(title: "Import Transactions", subtitle: "Upload a file to bulk import transactions") do |header| %>
    <% header.with_actions do %>
      <%= render ButtonComponent.new(variant: :ghost, href: transactions_path, icon: "arrow-left") do %>
        Back to Transactions
      <% end %>
    <% end %>
  <% end %>

  <div class="max-w-2xl mx-auto space-y-6">
    <%# Upload Card %>
    <div class="animate-card-entrance stagger-1">
      <%= render CardComponent.new do %>
        <%= form_with url: preview_imports_path, method: :post, multipart: true, data: { controller: "file-upload", action: "submit->file-upload#validate" } do |f| %>
          <div class="space-y-6">
            <div class="text-center">
              <div class="mx-auto w-12 h-12 rounded-2xl bg-primary-500/10 flex items-center justify-center mb-4">
                <%= heroicon "arrow-up-tray", variant: :outline, options: { class: "w-6 h-6 text-primary-500" } %>
              </div>
              <h2 class="text-lg font-semibold text-text-primary">Upload Transaction File</h2>
              <p class="mt-1 text-sm text-text-secondary">Select a file from your bank or financial institution</p>
            </div>

            <%# Drop zone / File input %>
            <div class="relative">
              <label for="import_file"
                class="flex flex-col items-center justify-center w-full h-48 rounded-2xl border-2 border-dashed border-glass-border
                       hover:border-primary-500/50 hover:bg-primary-500/5 transition-all duration-300 cursor-pointer group">
                <div class="flex flex-col items-center justify-center pt-5 pb-6" data-file-upload-target="placeholder">
                  <%= heroicon "document-text", variant: :outline, options: { class: "w-10 h-10 text-text-muted group-hover:text-primary-500 transition-colors mb-3" } %>
                  <p class="mb-2 text-sm text-text-secondary">
                    <span class="font-semibold text-primary-500">Click to upload</span> or drag and drop
                  </p>
                  <p class="text-xs text-text-muted">CSV, OFX, QFX, QIF, or PDF files (max 5MB)</p>
                </div>
                <div class="hidden flex-col items-center justify-center pt-5 pb-6" data-file-upload-target="preview">
                  <%= heroicon "document-check", variant: :outline, options: { class: "w-10 h-10 text-success-500 mb-3" } %>
                  <p class="text-sm font-medium text-text-primary" data-file-upload-target="filename"></p>
                  <p class="text-xs text-text-muted mt-1" data-file-upload-target="filesize"></p>
                </div>
                <input id="import_file" name="file" type="file" accept=".csv,.ofx,.qfx,.qif,.pdf,text/csv,application/pdf" class="hidden"
                       data-file-upload-target="input" data-action="change->file-upload#preview" />
              </label>
            </div>

            <%# Submit button %>
            <div class="flex justify-end">
              <%= render ButtonComponent.new(variant: :primary, submit: true, icon: "arrow-right") do %>
                Continue to Preview
              <% end %>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>

    <%# Supported Formats Card %>
    <div class="animate-card-entrance stagger-2">
      <%= render CardComponent.new do %>
        <div class="space-y-4">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl bg-info-500/10 flex items-center justify-center shrink-0">
              <%= heroicon "light-bulb", variant: :outline, options: { class: "w-5 h-5 text-info-500" } %>
            </div>
            <h3 class="text-base font-semibold text-text-primary">Supported Formats</h3>
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div class="flex items-start gap-3">
              <div class="w-6 h-6 rounded-lg bg-success-500/10 flex items-center justify-center shrink-0 mt-0.5">
                <%= heroicon "check", variant: :mini, options: { class: "w-3.5 h-3.5 text-success-500" } %>
              </div>
              <div>
                <p class="text-sm font-medium text-text-primary">CSV (.csv)</p>
                <p class="text-xs text-text-muted mt-0.5">Standard comma-separated values with headers. Column mapping available.</p>
              </div>
            </div>

            <div class="flex items-start gap-3">
              <div class="w-6 h-6 rounded-lg bg-success-500/10 flex items-center justify-center shrink-0 mt-0.5">
                <%= heroicon "check", variant: :mini, options: { class: "w-3.5 h-3.5 text-success-500" } %>
              </div>
              <div>
                <p class="text-sm font-medium text-text-primary">OFX / QFX (.ofx, .qfx)</p>
                <p class="text-xs text-text-muted mt-0.5">Open Financial Exchange format used by most banks and Quicken.</p>
              </div>
            </div>

            <div class="flex items-start gap-3">
              <div class="w-6 h-6 rounded-lg bg-success-500/10 flex items-center justify-center shrink-0 mt-0.5">
                <%= heroicon "check", variant: :mini, options: { class: "w-3.5 h-3.5 text-success-500" } %>
              </div>
              <div>
                <p class="text-sm font-medium text-text-primary">QIF (.qif)</p>
                <p class="text-xs text-text-muted mt-0.5">Quicken Interchange Format, a legacy format still used by some institutions.</p>
              </div>
            </div>

            <div class="flex items-start gap-3">
              <div class="w-6 h-6 rounded-lg bg-warning-500/10 flex items-center justify-center shrink-0 mt-0.5">
                <%= heroicon "exclamation-triangle", variant: :mini, options: { class: "w-3.5 h-3.5 text-warning-500" } %>
              </div>
              <div>
                <p class="text-sm font-medium text-text-primary">PDF (.pdf) <span class="text-warning-600 text-xs">Beta</span></p>
                <p class="text-xs text-text-muted mt-0.5">Best-effort extraction from bank statements. Review results carefully.</p>
              </div>
            </div>
          </div>

          <div class="pt-3 border-t border-glass-border">
            <p class="text-xs text-text-muted">
              <span class="font-medium">Auto-detection:</span> File type is determined by extension.
              Duplicate transactions are automatically detected and skipped.
              All imported transactions are flagged for review.
            </p>
          </div>
        </div>
      <% end %>
    </div>

    <%# Example format Card %>
    <div class="animate-card-entrance stagger-3">
      <%= render CardComponent.new do %>
        <div class="space-y-3">
          <div class="flex items-center gap-3">
            <div class="w-10 h-10 rounded-xl bg-warning-500/10 flex items-center justify-center shrink-0">
              <%= heroicon "table-cells", variant: :outline, options: { class: "w-5 h-5 text-warning-500" } %>
            </div>
            <h3 class="text-base font-semibold text-text-primary">Example CSV Format</h3>
          </div>

          <div class="overflow-x-auto rounded-xl border border-glass-border">
            <table class="w-full text-xs">
              <thead>
                <tr class="bg-surface-hover/50">
                  <th class="px-3 py-2 text-left font-semibold text-text-secondary">Date</th>
                  <th class="px-3 py-2 text-left font-semibold text-text-secondary">Description</th>
                  <th class="px-3 py-2 text-right font-semibold text-text-secondary">Amount</th>
                  <th class="px-3 py-2 text-left font-semibold text-text-secondary">Category</th>
                </tr>
              </thead>
              <tbody class="divide-y divide-glass-border">
                <tr>
                  <td class="px-3 py-1.5 text-text-primary">01/15/2024</td>
                  <td class="px-3 py-1.5 text-text-primary">Grocery Store</td>
                  <td class="px-3 py-1.5 text-right text-danger-600">-45.99</td>
                  <td class="px-3 py-1.5 text-text-muted">Food & Groceries</td>
                </tr>
                <tr>
                  <td class="px-3 py-1.5 text-text-primary">01/15/2024</td>
                  <td class="px-3 py-1.5 text-text-primary">Payroll Deposit</td>
                  <td class="px-3 py-1.5 text-right text-success-600">3,200.00</td>
                  <td class="px-3 py-1.5 text-text-muted">Salary</td>
                </tr>
                <tr>
                  <td class="px-3 py-1.5 text-text-primary">01/16/2024</td>
                  <td class="px-3 py-1.5 text-text-primary">Electric Company</td>
                  <td class="px-3 py-1.5 text-right text-danger-600">-125.00</td>
                  <td class="px-3 py-1.5 text-text-muted">Utilities</td>
                </tr>
              </tbody>
            </table>
          </div>

          <p class="text-xs text-text-muted">
            Your bank's CSV format may differ -- that is fine. You can adjust the column mapping in the next step.
          </p>
        </div>
      <% end %>
    </div>
  </div>
</div>
