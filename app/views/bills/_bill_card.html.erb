<%# locals: (bill:) %>
<%= render CardComponent.new(class: "group relative") do %>
  <%# Top row: Name + Amount/Badge %>
  <div class="flex items-start justify-between mb-3">
    <div class="flex-1 min-w-0 pr-3">
      <h3 class="text-base font-semibold text-text-primary truncate"><%= bill.name %></h3>
      <div class="flex items-center gap-2 mt-1">
        <span class="text-xs text-text-muted capitalize"><%= bill.frequency %></span>
        <% if bill.category.present? %>
          <span class="text-xs text-text-muted">&middot; <%= bill.category.name %></span>
        <% end %>
        <% if bill.auto_pay? %>
          <span class="inline-flex items-center gap-1 text-xs text-info-600">
            <%= heroicon "bolt", variant: :mini, options: { class: "w-3 h-3" } %>
            Auto-pay
          </span>
        <% end %>
      </div>
    </div>
    <div class="text-right flex-shrink-0">
      <p class="text-lg font-bold text-text-primary"><%= number_to_currency(bill.amount) %></p>
      <%= render BadgeComponent.new(variant: bill.status_variant, dot: true, size: :sm) do %>
        <%= bill.status.to_s.humanize %>
      <% end %>
    </div>
  </div>

  <%# Due date info %>
  <div class="flex items-center gap-1.5 text-sm text-text-secondary mb-4">
    <%= heroicon "calendar-days", variant: :outline, options: { class: "w-4 h-4" } %>
    <% if bill.status == :paid %>
      <span>Next: <%= bill.next_due_date.strftime("%b %d, %Y") %></span>
    <% elsif bill.status == :overdue %>
      <span class="text-danger-600">Due <%= bill.next_due_date.strftime("%b %d, %Y") %></span>
    <% else %>
      <span>Due <%= bill.next_due_date.strftime("%b %d, %Y") %></span>
      <% if bill.days_until_due > 0 %>
        <span class="text-text-muted">(<%= pluralize(bill.days_until_due, "day") %>)</span>
      <% elsif bill.days_until_due == 0 %>
        <span class="text-warning-600">(Today)</span>
      <% end %>
    <% end %>
  </div>

  <%# Action buttons %>
  <div class="flex items-center gap-2 pt-3 border-t border-glass-border">
    <% unless bill.status == :paid %>
      <%= button_to pay_bill_path(bill), method: :post, class: "inline-flex items-center gap-1.5 px-3 py-1.5 text-sm font-medium rounded-lg bg-success-50 text-success-700 hover:bg-success-100 transition-colors cursor-pointer" do %>
        <%= heroicon "check-circle", variant: :outline, options: { class: "w-4 h-4" } %>
        Mark Paid
      <% end %>
    <% end %>

    <%= render ButtonComponent.new(variant: :ghost, size: :sm, href: edit_bill_path(bill), icon: "pencil", data: { turbo_frame: "modal" }) do %>
      Edit
    <% end %>

    <%= render ButtonComponent.new(variant: :ghost, size: :sm, href: bill_path(bill), icon: "eye", data: { turbo_frame: "modal" }) do %>
      Details
    <% end %>

    <%= render ButtonComponent.new(
      variant: :ghost,
      size: :sm,
      href: bill_path(bill),
      method: :delete,
      confirm: "Delete '#{bill.name}'? This will also remove all payment history.",
      icon: "trash",
      class: "text-danger-600 hover:text-danger-700 opacity-0 group-hover:opacity-100 transition-opacity"
    ) do %>
    <% end %>
  </div>
<% end %>
