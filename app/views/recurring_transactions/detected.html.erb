<div class="space-y-6">
  <%= render PageHeaderComponent.new(title: "Detected Recurring Transactions") do |header| %>
    <% header.with_actions do %>
      <%= render ButtonComponent.new(variant: :ghost, href: recurring_transactions_path, icon: "arrow-left") do %>
        Back to Recurring
      <% end %>
    <% end %>
  <% end %>

  <%# Description %>
  <div class="animate-card-entrance stagger-1">
    <div class="glass rounded-2xl shadow-lg p-5 relative overflow-hidden">
      <div class="absolute inset-0 bg-gradient-to-br from-white/5 to-transparent pointer-events-none rounded-2xl"></div>
      <div class="relative flex items-start gap-3">
        <div class="flex-shrink-0 w-9 h-9 rounded-xl bg-primary-50 dark:bg-primary-500/10 flex items-center justify-center">
          <%= heroicon "magnifying-glass-circle", variant: :outline, options: { class: "w-5 h-5 text-primary-600 dark:text-primary-400" } %>
        </div>
        <div>
          <p class="text-sm text-text-secondary leading-relaxed">
            We analyzed your transaction history to find recurring patterns. These are transactions
            that appear to happen on a regular schedule with similar amounts. Review and set up
            recurring transactions for better tracking.
          </p>
        </div>
      </div>
    </div>
  </div>

  <% if @candidates.any? %>
    <div class="space-y-4">
      <% @candidates.each_with_index do |candidate, index| %>
        <div class="animate-card-entrance stagger-<%= [ index + 2, 6 ].min %>">
          <%= render CardComponent.new do %>
            <div class="flex items-start justify-between gap-4">
              <%# Left: Candidate Info %>
              <div class="flex items-start gap-4 flex-1 min-w-0">
                <%# Confidence indicator %>
                <div class="flex-shrink-0 w-12 h-12 rounded-xl flex items-center justify-center
                  <% if candidate.confidence >= 0.8 %>
                    bg-success-50 dark:bg-success-500/10
                  <% elsif candidate.confidence >= 0.6 %>
                    bg-warning-50 dark:bg-warning-500/10
                  <% else %>
                    bg-gray-50 dark:bg-gray-500/10
                  <% end %>
                ">
                  <% if candidate.confidence >= 0.8 %>
                    <%= heroicon "check-circle", variant: :outline, options: { class: "w-6 h-6 text-success-600 dark:text-success-400" } %>
                  <% elsif candidate.confidence >= 0.6 %>
                    <%= heroicon "question-mark-circle", variant: :outline, options: { class: "w-6 h-6 text-warning-600 dark:text-warning-400" } %>
                  <% else %>
                    <%= heroicon "minus-circle", variant: :outline, options: { class: "w-6 h-6 text-gray-500 dark:text-gray-400" } %>
                  <% end %>
                </div>

                <div class="min-w-0 flex-1">
                  <div class="flex items-center gap-3 mb-1">
                    <h3 class="font-semibold text-text-primary text-base truncate"><%= candidate.payee %></h3>
                    <%= render BadgeComponent.new(
                      variant: candidate.confidence >= 0.8 ? :success : candidate.confidence >= 0.6 ? :warning : :neutral,
                      size: :sm
                    ) do %>
                      <%= (candidate.confidence * 100).round %>% confidence
                    <% end %>
                  </div>

                  <div class="flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-text-muted">
                    <span class="inline-flex items-center gap-1">
                      <%= heroicon "arrow-path", variant: :mini, options: { class: "w-3.5 h-3.5" } %>
                      <%= candidate.frequency.to_s.humanize %>
                    </span>
                    <span class="inline-flex items-center gap-1">
                      <%= heroicon "calendar", variant: :mini, options: { class: "w-3.5 h-3.5" } %>
                      Every ~<%= candidate.interval_days %> days
                    </span>
                    <span class="inline-flex items-center gap-1">
                      <%= heroicon "hashtag", variant: :mini, options: { class: "w-3.5 h-3.5" } %>
                      <%= candidate.occurrence_count %> occurrences
                    </span>
                    <span class="inline-flex items-center gap-1">
                      <%= heroicon "clock", variant: :mini, options: { class: "w-3.5 h-3.5" } %>
                      Last: <%= candidate.last_date.strftime("%b %d, %Y") %>
                    </span>
                  </div>

                  <% if candidate.next_predicted_date %>
                    <p class="mt-1 text-xs text-text-muted">
                      Next expected: <span class="font-medium text-text-secondary"><%= candidate.next_predicted_date.strftime("%b %d, %Y") %></span>
                      <% if candidate.next_predicted_date < Date.current %>
                        <span class="text-danger-600 dark:text-danger-400 font-medium">(overdue)</span>
                      <% elsif candidate.next_predicted_date <= 7.days.from_now.to_date %>
                        <span class="text-warning-600 dark:text-warning-400 font-medium">(upcoming)</span>
                      <% end %>
                    </p>
                  <% end %>
                </div>
              </div>

              <%# Right: Amount + Action %>
              <div class="flex flex-col items-end gap-2 flex-shrink-0">
                <p class="text-lg font-bold text-text-primary tabular-nums">
                  <%= number_to_currency(candidate.average_amount) %>
                </p>
                <p class="text-[10px] text-text-muted uppercase tracking-wide">avg per occurrence</p>
                <%= render ButtonComponent.new(
                  variant: :primary,
                  size: :sm,
                  href: new_recurring_transaction_path(
                    recurring_transaction: {
                      description: candidate.payee,
                      amount: candidate.average_amount,
                      frequency: candidate.frequency,
                      next_occurrence: candidate.next_predicted_date
                    }
                  ),
                  icon: "plus",
                  data: { turbo_frame: "modal" }
                ) do %>
                  Set Up
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="animate-card-entrance stagger-2">
      <%= render CardComponent.new do %>
        <%= render EmptyStateComponent.new(
          title: "No recurring patterns detected",
          description: "We couldn't find enough recurring transaction patterns. Add more transactions or check back later as your history grows.",
          icon: "magnifying-glass"
        ) %>
      <% end %>
    </div>
  <% end %>
</div>
